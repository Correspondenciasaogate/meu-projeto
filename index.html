<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Encomendas</title>
    <style>
        :root {
            --cor-primaria: #16a34a;
            --cor-secundaria: #64748b;
        }
        body { font-family: sans-serif; background: #f4f4f9; margin: 0; padding: 20px; }
        header { background: var(--cor-primaria); color: white; padding: 1rem; text-align: center; border-radius: 8px; margin-bottom: 20px; }
        
        .container { max-width: 900px; margin: auto; }
        
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h3 { margin-top: 0; color: #333; }

        .form-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        /* Destaque para o telefone autom치tico */
        #telefone { background-color: #f0fdf4; font-weight: bold; color: #16a34a; }

        button { background: var(--cor-primaria); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
        button:hover { opacity: 0.9; }

        .stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-item { flex: 1; background: white; padding: 15px; border-radius: 8px; text-align: center; border-bottom: 4px solid var(--cor-primaria); }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8fafc; }
        tr:hover { background: #f1f5f9; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Sistema de Encomendas</h1>
    </header>

    <div class="stats">
        <div class="stat-item">
            <small>Hoje</small>
            <div id="dashTotal" style="font-size: 1.5em; font-weight: bold;">0</div>
        </div>
        <div class="stat-item">
            <small>Aguardando</small>
            <div id="dashAguardando" style="font-size: 1.5em; font-weight: bold; color: #f59e0b;">0</div>
        </div>
    </div>

    <div class="card">
        <h3 id="tituloForm">游닍 Novo Recebimento</h3>
        <form id="formRecebimento">
            <input type="hidden" id="editId">
            <div class="form-group">
                <div>
                    <label>Nota Fiscal</label>
                    <input type="text" id="notaFiscal" required>
                </div>
                <div>
                    <label>Torre</label>
                    <select id="torre" onchange="buscarContatoAutomatico()">
                        <option value="Gate">Gate</option>
                        <option value="Way">Way</option>
                    </select>
                </div>
                <div>
                    <label>Sala (Digite apenas o n칰mero)</label>
                    <input type="text" id="sala" placeholder="Ex: 101" required oninput="buscarContatoAutomatico()">
                </div>
                <div>
                    <label>Telefone (Autom치tico)</label>
                    <input type="text" id="telefone" placeholder="Aparecer치 sozinho">
                </div>
                <div class="full-width">
                    <label>Nome do Destinat치rio</label>
                    <input type="text" id="destinatario" required>
                </div>
                <div class="full-width">
                    <button type="submit" id="btnSalvar">Salvar e Enviar WhatsApp</button>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <h3>游늶 Lista de Encomendas</h3>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Sala</th>
                        <th>Destinat치rio</th>
                        <th>Status</th>
                        <th>A칞칚o</th>
                    </tr>
                </thead>
                <tbody id="listaCorpo"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// AGENDA DE MORADORES (Baseada na sua lista anterior)
const agendaMoradores = {
    "Gate002": "11994392466", "Gate004": "11958649090", "Gate101": "11979861261", "Way101": "3598154110",
    "Way102": "11966584923", "Gate105": "11971556999", "Way501": "11952369167"
    // ... adicionei alguns exemplos, voc칡 pode completar com a lista gigante acima
};

let encomendas = JSON.parse(localStorage.getItem('encomendas_v1')) || [];

// FUN칂츾O PRINCIPAL: BUSCA AUTOM츼TICA
function buscarContatoAutomatico() {
    const torre = document.getElementById('torre').value;
    const sala = document.getElementById('sala').value.trim();
    const campoTelefone = document.getElementById('telefone');
    
    // Formata a chave para bater com a agenda (Ex: Gate + 101 = Gate101)
    const chave = torre + sala;
    
    if (agendaMoradores[chave]) {
        campoTelefone.value = agendaMoradores[chave];
        campoTelefone.style.backgroundColor = "#dcfce7"; // Verde se achar
    } else {
        campoTelefone.value = "";
        campoTelefone.style.backgroundColor = ""; // Branco se n칚o achar
    }
}

// SALVAR ENCOMENDA
document.getElementById('formRecebimento').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const nova = {
        id: Date.now(),
        nf: document.getElementById('notaFiscal').value,
        torre: document.getElementById('torre').value,
        sala: document.getElementById('sala').value,
        destinatario: document.getElementById('destinatario').value,
        telefone: document.getElementById('telefone').value,
        data: new Date().toLocaleDateString('pt-BR'),
        status: 'Aguardando retirada'
    };

    encomendas.push(nova);
    localStorage.setItem('encomendas_v1', JSON.stringify(encomendas));
    
    // Simula envio de Zap
    if(nova.telefone) {
        const msg = `Ol치 ${nova.destinatario}, sua encomenda NF ${nova.nf} chegou!`;
        window.open(`https://api.whatsapp.com/send?phone=55${nova.telefone.replace(/\D/g,'')}&text=${encodeURIComponent(msg)}`, '_blank');
    }

    this.reset();
    renderizar();
});

function renderizar() {
    const corpo = document.getElementById('listaCorpo');
    corpo.innerHTML = '';
    
    encomendas.forEach(item => {
        corpo.innerHTML += `
            <tr>
                <td>${item.data}</td>
                <td>${item.torre} ${item.sala}</td>
                <td>${item.destinatario}</td>
                <td>${item.status}</td>
                <td><button onclick="apagar(${item.id})" style="padding:5px; background:red;">X</button></td>
            </tr>
        `;
    });
    
    document.getElementById('dashTotal').innerText = encomendas.filter(e => e.data === new Date().toLocaleDateString('pt-BR')).length;
    document.getElementById('dashAguardando').innerText = encomendas.filter(e => e.status === 'Aguardando retirada').length;
}

function apagar(id) {
    encomendas = encomendas.filter(e => e.id !== id);
    localStorage.setItem('encomendas_v1', JSON.stringify(encomendas));
    renderizar();
}

// Inicia a tabela ao abrir
renderizar();
</script>

</body>
</html>
